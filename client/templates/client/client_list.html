<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고객 목록</title>

    <style>
        .pagination a.previous {
            width: 50px;  /* 예시 값, 필요에 따라 조정하세요 */
            height: 20px; /* 예시 값, 필요에 따라 조정하세요 */
            display: inline-block;
        }
        .pagination a {
    display: inline-block;
    width: 50px;  /* 페이지 번호의 고정 너비 설정, 필요에 따라 조정 가능 */
    text-align: center;  /* 내용 중앙 정렬 */
    margin: 0 5px;  /* 페이지 번호 간의 간격 설정 */
    padding: 5px 0;  /* 페이지 번호 내의 여백 설정 */
    border: 1px solid #ccc;  /* 테두리 설정, 필요에 따라 스타일 조정 가능 */
    border-radius: 5px;  /* 둥근 모서리 설정, 필요에 따라 조정 가능 */
}

.pagination .page-current {
    width: auto;  /* 현재 페이지 번호의 너비를 자동으로 설정 */
    margin: 0 5px;  /* 다른 페이지 번호와의 간격 설정 */
    padding: 5px 10px;  /* 내용의 여백 설정 */
    background-color: #f5f5f5;  /* 현재 페이지 번호의 배경색 설정, 필요에 따라 조정 가능 */
}



/* 아래 부터는 모달에 관한 css 입니다 */

.mockup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 50%;
    height: 60vh; /* 화면 세로의 60%를 높이로 설정 */
    background-color: #fff;
    border: 1px solid #ccc;
    padding: 40px 0; /* 상하 여백 40px, 좌우 여백 0으로 설정 */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column; /* 내부 컨텐츠를 세로로 배열하기 위한 설정 */
    justify-content: center;
    align-items: center;
}

.button-container {
    display: flex;
    justify-content: center;
    align-items: center; /* 수직 중앙 정렬을 위해 추가 */
    gap: 10px; /* 버튼 사이의 간격을 조절합니다. 필요에 따라 조절 가능 */
    margin-top: 8%;
}

button.upload-button, button.action-button {
    padding: 15px 25px;  
    font-size: 16px;
    width: 30%;
    margin: 3% 5%; 
    border: none;
    background-color: #ddd;
    cursor: pointer;
    transition: background-color 0.3s ease;
    box-sizing: border-box;
}

button.upload-button:hover, button.action-button:hover {
    background-color: #ccc;
}



</style>

</head>
<body>

    <ul class="nav navbar-nav navbar-right">
        {% if not user.is_authenticated %}
            <li><a href="{% url 'account:signup' %}">회원 가입 </a> </li>
            <li><a href="{% url 'account:login' %}?next={{request.path}}">로그인</a></li>
        {% else %}
            <li><a href="">{{user}}님!</a> </li> 
            <li><a href="{%  url 'account:logout' %}?next={{request.path}}">로그 아웃</a></li>
        {% endif %}
     </ul>
    
    {% comment %} <button onclick="openMockup()">파일 업로드 하기</button>

    <div id="mockup" class="mockup">

        <div class="button-container">
            <button class="upload-button" onclick="loadContentIntoMockup('{% url 'client:upload' %}')">고객 정보 업로드</button>
            <button class="action-button" onclick="loadContentIntoMockup('{% url 'account:file_upload' %}')">회사 파일 업로드</button>
        </div>
        
        <br><br>    

        <div class="button-container">
            <button class="action-button">업로드하기</button>
            <button class="action-button" onclick="closeMockup()">취소하기</button>
        </div>

    </div> {% endcomment %}


    <button><a href="{% url 'client:upload' %}">고객 정보 업로드</a></button>
    <button><a href="{% url 'account:file_upload' %}">회사 파일 업로드</a></button>


    <h2>고객 목록</h2>


    <form method="post" action="{% url 'client:delete_selected' %}" id='client_form'>
        {% csrf_token %}
        <table border="1"> 
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all"></th>
                    <th>이름</th>
                    <th>주소</th>
                    <th>전화번호</th>
                    <th>생년월일</th>
                    <th>나이</th>
                    <th>성별</th>
                    <th>이메일</th>
                    <th>상담날짜</th>
                    <th>TM 목적</th>
                    <th>감성</th>
                    <th>고객관리</th>
                </tr>
            </thead>
            <tbody>
                {% for client in client_obj %}
                    <tr>
                        <td><input type="checkbox" name="client_ids" value="{{ client.id }}"></td>
                        <td>{{ client.name }}</td>
                        <td>{{ client.location }}</td>
                        <td>{{ client.number }}</td>
                        <td>{{ client.birth_date }}</td>
                        <td>{{ client.age }}</td>
                        <td>{{ client.gender }}</td>
                        <td>{{ client.email }}</td>
                        <td>{{ client.tm_date|date:"Y. m. d P" }}</td>
                        <td>추가해야함</td>
                        <td>O/X</td>
                        <td>
                            <a href="{% url 'client:edit_client' client.id %}">수정하기</a> | 
                            <a href="{% url 'client:delete_client' client.id %}">삭제하기</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        

        <div class="pagination">
            <span class="page-links">
        
                {% if client_obj.has_previous %}
                <br>
                    <a href="?client_page={{ client_obj.previous_page_number }}" class="previous">이전</a>
                {% else %}
                <br>
                    <a href="?client_page={{ client_obj.paginator.num_pages }}" class="next">이전</a>
                {% endif %}

                <span class="page-current">
                    {{ client_obj.number }} / {{ client_obj.paginator.num_pages }}
                </span>
        
                {% if client_obj.has_next %}
                    <a href="?client_page={{ client_obj.next_page_number }}" class="next">다음</a>
                {% else %}
                    <a href="?client_page={{ 1 }}" class="next">다음</a>
                {% endif %}
                
            </span>
        </div>

    <br><br>

        <button type="submit">선택된 고객 삭제</button>
    </form>
        <button><a href="{% url 'client:selected_items' %}">아웃바운드 나가기</a></button>

        <br>
        <h2>파일 목록</h2>

    <form method="post" action="{% url 'account:delete_selected' %}" id='file_form'>
        {% csrf_token %}
        <table border="1"> 
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all2"></th>
                    <th>파일 이름</th>
                    <th>업로드 날짜</th>
                    <th>설명</th>
                    <th>파일관리</th>
                </tr>
            </thead>
            <tbody>
                {% for file in file_obj %}
                    <tr>
                        <td><input type="checkbox" name="file_ids" value="{{ file.id }}"></td>
                        <td>{{ file.file.name|cut:"user_files/" }}</td>
                        <td>{{ file.upload_date }}</td>
                        <td>{{ file.description }}</td>
                        <td>
                            <a href="{% url 'account:edit_file' file.id %}">수정하기</a> | 
                            <a href="{% url 'account:delete_file' file.id %}">삭제하기</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    
        <div class="pagination">
            <span class="page-links">
        
                {% if file_obj.has_previous %}
                <br>
                    <a href="?file_page={{ file_obj.previous_page_number }}" class="previous">이전</a>
                {% else %}
                <br>
                    <a href="?file_page={{ file_obj.paginator.num_pages }}" class="next">이전</a>
                {% endif %}

                <span class="page-current">
                    {{ file_obj.number }} / {{ file_obj.paginator.num_pages }}
                </span>
        
                {% if file_obj.has_next %}
                    <a href="?file_page={{ file_obj.next_page_number }}" class="next">다음</a>
                {% else %}
                    <a href="?file_page={{ 1 }}" class="next">다음</a>
                {% endif %}
                
            </span>
        </div> 
    <br><br>

    

        <button type="submit">선택된 파일 삭제</button>

    </form>
<br><br>




<!-- 전체 선택하는 버튼, 선택된 고객 삭제 버튼 클릭 시 경고창 뜨게 구현-->
<script>
    document.addEventListener('DOMContentLoaded', function() {
    
        const selectAllCheckbox = document.getElementById('select-all');   //select-all 읽기
    
        selectAllCheckbox.addEventListener('change', function() {  // selectAll 체크박스의 상태가 변경될 때마다 실행
            const checkboxes = document.querySelectorAll('input[name="client_ids"]');  //모든 체크 된 요소 가져오기
    
            // selectAll 체크박스의 상태에 따라 모든 체크박스의 상태 변경
            checkboxes.forEach(function(checkbox) {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });
    
        // 고객 삭제 버튼에 대한 이벤트 리스너
        const deleteButton = document.querySelector('button[type="submit"]');
        deleteButton.addEventListener('click', function(event) {
            const checkedCount = document.querySelectorAll('input[name="client_ids"]:checked').length;
    
            if (checkedCount > 0) {
                const confirmed = confirm('정말 선택된 고객을 삭제하시겠습니까?');
                if (!confirmed) {
                    event.preventDefault(); // 폼 제출 중지
                }
            }
        });
    

});

    document.addEventListener('DOMContentLoaded', function() {
        
        const selectAllCheckbox = document.getElementById('select-all2');   //select-all 읽기

        
        selectAllCheckbox.addEventListener('change', function() {  // selectAll 체크박스의 상태가 변경될 때마다 실행
            
            const checkboxes = document.querySelectorAll('input[name="file_ids"]');  //모든 체크 된 요소 가져오기

            // selectAll 체크박스의 상태에 따라 모든 체크박스의 상태 변경
            checkboxes.forEach(function(checkbox) {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });

        //확인 메시지 표시
        const form = document.getElementById('file_form');
        form.addEventListener('submit', function(event) {
            const checkedCount = document.querySelectorAll('input[name="file_ids"]:checked').length;

            if (checkedCount > 0) {
                const confirmed = confirm('정말 선택된 파일을 삭제하시겠습니까?');
                if (!confirmed) {
                    event.preventDefault(); // 폼 제출 중지
                }
            } 
        });
    });

    document.addEventListener('DOMContentLoaded', function() {

        const outboundButton = document.querySelector('button > a[href="{% url 'client:selected_items' %}"]');
        outboundButton.addEventListener('click', function(event) {
            event.preventDefault(); 
    

            const selectedClientIds = Array.from(document.querySelectorAll('input[name="client_ids"]:checked')).map(checkbox => checkbox.value);
            const selectedFileIds = Array.from(document.querySelectorAll('input[name="file_ids"]:checked')).map(checkbox => checkbox.value);

            const urlParams = new URLSearchParams();
            urlParams.append('selected_clients', selectedClientIds.join(','));
            urlParams.append('selected_files', selectedFileIds.join(','));
    
            // 새로운 URL로 이동
            window.location.href = "{% url 'client:selected_items' %}?" + urlParams.toString();
        });
    });

</script>


<script>
    function openMockup() {
        const mockup = document.getElementById('mockup');
        mockup.style.display = 'block';
    }
    
    function closeMockup() {
        const mockup = document.getElementById('mockup');
        mockup.style.display = 'none';
    }

    // 페이지 로드 시 목업 숨기기
    document.addEventListener('DOMContentLoaded', function() {
        const mockup = document.getElementById('mockup');
        mockup.style.display = 'none';
    });
</script>

<script>
    function loadContentIntoMockup(url) {
        fetch(url)
        .then(response => response.text())
        .then(data => {
            const mockupContent = document.getElementById('mockup');
            mockupContent.innerHTML = data;
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
    }

</script>



</body>
</html>
