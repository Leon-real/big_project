<!DOCTYPE html>
{% extends 'base.html' %} <!-- 이거 C:\Users\user\Desktop\big_project\templates\base.html으로 연결되는거였네? -->

{% load static %}

{% block static %}
    <!-- 외부 CSS 파일에 대한 링크 -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
{% endblock %}

{% block content %}

<!-- 배너 -->
<section id="banner">
    <div class="inner">
        <header>
            <h1>TeleManager</h1>
            <p>Outbound TM Automation Service for Enterprises</p>
            
        </header>
        <a href="/" class="button big scrolly">챗봇 상담</a>
    </div>
</section>


<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고객 목록</title>

    <style>
        .pagination a.previous {
            width: 50px;  /* 예시 값, 필요에 따라 조정하세요 */
            height: 20px; /* 예시 값, 필요에 따라 조정하세요 */
            display: inline-block;
        }
        .pagination a {
        display: inline-block;
        width: 50px;  /* 페이지 번호의 고정 너비 설정, 필요에 따라 조정 가능 */
        text-align: center;  /* 내용 중앙 정렬 */
        margin: 0 5px;  /* 페이지 번호 간의 간격 설정 */
        padding: 5px 0;  /* 페이지 번호 내의 여백 설정 */
        border: 1px solid #ccc;  /* 테두리 설정, 필요에 따라 스타일 조정 가능 */
        border-radius: 5px;  /* 둥근 모서리 설정, 필요에 따라 조정 가능 */
        }

        .pagination .page-current {
            width: auto;  /* 현재 페이지 번호의 너비를 자동으로 설정 */
            margin: 0 5px;  /* 다른 페이지 번호와의 간격 설정 */
            padding: 5px 10px;  /* 내용의 여백 설정 */
            background-color: #f5f5f5;  /* 현재 페이지 번호의 배경색 설정, 필요에 따라 조정 가능 */
        }
    </style>

</head>
<body> <!-- 수정사항 -->

    <ul class="nav navbar-nav navbar-right">
        {% if not user.is_authenticated %}
            <li><a href="{% url 'account:signup' %}">회원 가입 </a> </li>
            <li><a href="{% url 'account:login' %}?next={{request.path}}">로그인</a></li>
        {% else %}
            <li><a href="">{{user}}님!</a> </li> 
            <li><a href="{%  url 'account:logout' %}?next={{request.path}}">로그 아웃</a></li>
        {% endif %}
     </ul>

     <a href="{% url 'client:open_modal' %}" hx-get="{% url 'client:open_modal' %}" hx-trigger="click" hx-target="#myModal" hx-swap="innerHTML" hx-indicator=".loading-indicator">모달 열기</a>

     <div class="loading-indicator" style="display:none;">Loading...</div>
   
     <!-- 모달을 포함할 영역 -->
     <div hx-target="#myModal"></div>
   
     <!-- htmx 스크립트 로드 -->
     <script src="{% static 'js/htmx.js' %}"></script>
     
{% block customer_info %}
<h2>고객 목록</h2>


<form method="post" action="{% url 'client:delete_selected' %}">
    {% csrf_token %}
    <table border="1"> 
        <thead>
            <tr>
                <th><div><input type="checkbox" id="select-all"><label for="select-all"></label></div></th>
                <th>이름</th>
                <th>주소</th>
                <th>전화번호</th>
                <th>생년월일</th>
                <th>나이</th>
                <th>성별</th>
                <th>이메일</th>
                <th>고객관리</th>
            </tr>
        </thead>
        <tbody>
            {% for client in client_list %}
                <tr>
                    <td> 
                        <div>
                            <input type="checkbox" id="copy_{{ client.id }}" name="client_ids" value="{{ client.id }}">
                            <label for="copy_{{ client.id }}"></label>
                        </div>
                    </td>
                    <td><a href="{% url 'client:edit_client' client.id %}">{{ client.name }}</a></td>
                    <td>{{ client.location }}</td>
                    <td>{{ client.number }}</td>
                    <td>{{ client.birth_date }}</td>
                    <td>{{ client.age }}</td>
                    <td>{{ client.gender }}</td>
                    <td>{{ client.email }}</td>
                    <td>
                        <a href="{% url 'client:edit_client' client.id %}">수정하기</a> | 
                        <a href="{% url 'client:delete_client' client.id %}">삭제하기</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <button type="submit">선택된 고객 삭제</button>

</form>
<br><br>

{% if is_paginated %}
<div class="pagination">
    <span class="page-links">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="previous">이전</a>
        {% else %}
            <!-- 맨 처음 페이지일 때, 이전 버튼이 마지막으로  -->
            <a href="?page={{ page_obj.paginator.num_pages }}" class="previous">이전</a>
        {% endif %}

        <span class="page-current">
                {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}"  class="previous">다음</a>
        {% else %}
            <!-- 맨 처음 페이지일 때, 다음 버튼이 첫 페이지로 -->
            <a href="?page=1" class="previous">다음</a>
        {% endif %}
    </span>
</div>
{% endif %}
{% endblock %}



{% if tmgoal %}
    <p>마케팅 목적 : {{ tmgoal }}</p>
{% else %}
    <p>tmgoal이 없습니다.</p>
{% endif %}


<!-- 1226 추가내용 Inserted code for upload forms and buttons -->
<style>
    .upload-form-container {
        display: flex;
        justify-content: center; /* space-between; */
        gap: 10%;
    }

    .upload-form {
        width: 45%; /* 두 업로드 폼의 너비를 조절할 수 있습니다. */
        margin-right: 5%; /* 각 업로드 폼의 우측 마진을 추가하여 간격을 조절합니다. */
    }

    /* 마지막 업로드 폼에는 마진을 추가하지 않습니다. */
    .upload-form:last-child {
        margin-right: 0;
    }
</style>

<!-- 추가된 JavaScript 코드 -->
<script language="javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // 초기에 알파 버튼만 보이게 설정
        showButton('알파');
    });
    
    function showButton(val) {
        var alphaButton = document.getElementById('알파');
        var betaButton = document.getElementById('베타');
        var message = document.getElementById('message');
        var uploadForm = document.getElementById('upload-form');
        var uploadForm2 = document.getElementById('upload-form-2');
    
        if (val === '알파') {
            alphaButton.style.display = 'block';
            betaButton.style.display = 'none';
            message.innerHTML = '';
            uploadForm.style.display = 'none';
            uploadForm2.style.display = 'none';
        } else if (val === '베타') {
            alphaButton.style.display = 'none';
            betaButton.style.display = 'block';
            message.innerHTML = '';
            uploadForm.style.display = 'block';
            uploadForm2.style.display = 'block';
        } else if (val === '감마') {
            alphaButton.style.display = 'none';
            betaButton.style.display = 'none';
            message.innerHTML = '';
            uploadForm.style.display = 'none';
            uploadForm2.style.display = 'none';
        }
    }
    </script>

<!-- 버튼들 -->
<button id="알파" onclick="showButton('베타');">a</button>
<button id="베타" style="display: none;" onclick="showButton('알파');">b</button>

<!-- 메시지 표시 영역 -->
<div id="message"></div>

<!-- 업로드 폼 -->
<div class="upload-form-container">
    <form id="upload-form" method="post" enctype="multipart/form-data" action="{% url 'client:upload' %}" style="display: none;">
        {% csrf_token %}
        <label for="excel_file">고객 파일 업로드:</label>
        <input type="file" name="excel_file" accept=".xlsx, .xls">
        <button type="submit">업로드</button>
    </form>

    <!-- 두 번째 업로드 폼 -->
    <form id="upload-form-2" method="post" enctype="multipart/form-data" action="{% url 'client:upload' %}" style="display: none;">
        {% csrf_token %}
        <label for="excel_file_2">회사 파일 업로드:</label>
        <input type="file" name="excel_file_2" accept=".xlsx, .xls">
        <button type="submit">업로드</button>
    </form>
</div>




{% block marketing_info %}
<!-- 마케팅 정보 -->
<h2>마케팅 정보</h2>

<form method="post" action="{% url 'client:delete_selected' %}">
    {% csrf_token %}
    <table border="1"> 
        <thead>
            <tr>
                <th><div><input type="checkbox" id="select-all2"><label for="select-all2"></label></div></th>
                <th>파일목록</th>
                <th>수정하기</th>
            </tr>
        </thead>
        <tbody>
            {% for file in file_list %}
                <tr>
                    <td> 
                        <div>
                            <input type="checkbox" id="list_{{ file.id }}" name="file_ids" value="{{ file.id }}">
                            <label for="list_{{ file.id }}"></label>
                        </div>
                    </td>
                    <td>{{ file.name }}</td>
                    <td>{{ file.location }}</td>
                    <td>
                        <a href="{% url 'client:edit_client' file.id %}">수정하기</a> | 
                        <a href="{% url 'client:delete_client' file.id %}">삭제하기</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <br><br>
    <button type="submit">선택된 파일 삭제</button>
    <!-- <button><a href="{% url 'client:upload' %}">고객 정보 업로드</a></button> -->
    <button onclick="showMessageBox()">클릭하세요</button>


</form>
<br><br>

{% if is_paginated %}
<div class="pagination">
    <span class="page-links">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="previous">이전</a>
        {% else %}
            <!-- 맨 처음 페이지일 때, 이전 버튼이 마지막으로  -->
            <a href="?page={{ page_obj.paginator.num_pages }}" class="previous">이전</a>
        {% endif %}

        <span class="page-current">
                {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}"  class="previous">다음</a>
        {% else %}
            <!-- 맨 처음 페이지일 때, 다음 버튼이 첫 페이지로 -->
            <a href="?page=1" class="previous">다음</a>
        {% endif %}
    </span>
</div>
{% endif %}
{% endblock %}


<!-- 전체 선택하는 버튼, 선택된 고객 삭제 버튼 클릭 시 경고창 뜨게 구현-->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const selectAllCheckbox = document.getElementById('select-all');   //select-all 읽기

        
        selectAllCheckbox.addEventListener('change', function() {  // selectAll 체크박스의 상태가 변경될 때마다 실행
            
            const checkboxes = document.querySelectorAll('input[name="client_ids"]');  //모든 체크 된 요소 가져오기

            // selectAll 체크박스의 상태에 따라 모든 체크박스의 상태 변경
            checkboxes.forEach(function(checkbox) {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });

        //확인 메시지 표시
        const form = document.querySelector('form');
        form.addEventListener('submit', function(event) {
            const checkedCount = document.querySelectorAll('input[name="client_ids"]:checked').length;

            if (checkedCount > 0) {
                const confirmed = confirm('정말 선택된 고객을 삭제하시겠습니까?');
                if (!confirmed) {
                    event.preventDefault(); // 폼 제출 중지
                }
            } 
        });
    });





</script>

</body>
</html>
{% endblock %}