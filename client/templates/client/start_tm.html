{% load static %}

{% block static %}
    <!-- 외부 CSS 파일에 대한 링크 -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
{% endblock %}

{{ input_data }}


<!-- style로 분리해볼려고 했는데 id='chart'에서부터 꼬임. -->

<!--main-->
<div id="main" class="containered" style="display: flex; justify-content: space-between; align-items: flex-start;">
    <div id='chart' style="width: 200px; border: 1px solid #ccc; text-align: center;">
        <h3 style='font-size: 1rem;'>선택된 고객 목록</h3>
        <table border="1"> 
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all"></th>
                    <th>이름</th>
                    <th>주소</th>
                </tr>
            </thead>
            <tbody>
                {% for client in selectedClients %}
                    <tr>
                        <td><input type="checkbox" name="client_ids" value="{{ client.id }}"></td>
                        <td>{{ client.name }}</td>
                        <td>{{ client.location }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <h3 style='font-size: 1rem;'>선택된 파일 목록</h3>
        <table border="1"> 
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all2"></th>
                    <th>파일 이름</th>
                </tr>
            </thead>
            <tbody>
                {% for file in selectedFiles %}
                    <tr>
                        <td><input type="checkbox" name="file_ids" value="{{ file.id }}"></td>
                        <td>{{ file.file.name|cut:"_"|slice:"1:" }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <button id='goBack' onclick="goBack()">뒤로가기</button>
    </div>

    <!-- 채팅 대화창 -->
    <div id="chat-container" style="width: calc(100% - 230px); position: relative; border: 5px solid #ccc; margin-left: auto; margin-right: auto;">
        <div id="chat-window" class="chat-window" style="height: 470px; overflow-y: auto; margin-left:20px; margin-right:20px; display: flex; flex-direction: column-reverse;"></div>
        
        <!-- 채팅 입력창 -->
        <textarea id="chat-input" class="chat-input" placeholder="채팅을 입력해주세요" style="width: 100%; height: 100px; position: absolute; bottom: -100px; margin-left:0px; margin-right:0px; margin-top: 50px;"></textarea>
        <div>
            <button onclick="soundtrack" style="position: absolute; bottom: -140px;">녹음하기</button>
        </div>
    </div>
</div>




<script>
    function goBack() {
        window.history.back();
    }

    document.addEventListener('DOMContentLoaded', function () {
        // Get chat window element
        const chatWindow = document.getElementById('chat-window');

        // Get the initial chat answer from Django template
        const initialAnswer = '{{ mentsanswer }}';

        // Display the initial chat answer in the chat window
        if (initialAnswer.trim() !== '') {
            const botChatMessage = document.createElement('div');
            botChatMessage.className = 'chat-message';
            botChatMessage.textContent = `챗봇: ${initialAnswer}`;
            chatWindow.prepend(botChatMessage);
        }

        // Set up event listener for chat input
        const chatInput = document.getElementById('chat-input');
        chatInput.addEventListener('keydown', function (event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                const userMessage = chatInput.value.trim();

                if (userMessage !== '') {
                    // 사용자의 입력을 채팅창에 표시
                    const userChatMessage = document.createElement('div');
                    userChatMessage.className = 'chat-message';
                    userChatMessage.textContent = `사용자: ${userMessage}`;
                    chatWindow.prepend(userChatMessage); // 맨 위에 추가

                    // 입력창 초기화 및 포커스 유지
                    chatInput.value = '';
                    chatInput.focus();
                }
            }
        });
    });
</script>